â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“¦ SISTEMA DE MIGRACIÃ“N Y SINCRONIZACIÃ“N - PRODUCCIÃ“N     â”‚
â”‚  Sistema de PerfumerÃ­a - VersiÃ³n 2.0                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ¯ INICIO RÃPIDO
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

  1ï¸âƒ£  node create-backup.js           â† Crear backup + migrar
  2ï¸âƒ£  (Esperar confirmaciÃ³n)
  3ï¸âƒ£  npx prisma generate             â† Regenerar cliente
  4ï¸âƒ£  (Reiniciar backend)
  âœ…  Â¡Listo!


ğŸ“ ESTRUCTURA DE ARCHIVOS
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“‚ backend-perfumeria/
â”‚
â”œâ”€ ğŸ“„ README-SYNC-PRODUCTION.md          â­ LÃ‰EME PRIMERO
â”‚   â””â”€ GuÃ­a maestra con toda la informaciÃ³n
â”‚
â”œâ”€ ğŸ”§ SCRIPTS DE EJECUCIÃ“N (Node.js)
â”‚  â”‚
â”‚  â”œâ”€ create-backup.js                   ğŸ’¾ Backup automÃ¡tico
â”‚  â”‚   â””â”€ Crea backup antes de migrar
â”‚  â”‚   â””â”€ Comando: node create-backup.js
â”‚  â”‚
â”‚  â”œâ”€ execute-sync-production.js         â­ MigraciÃ³n automÃ¡tica
â”‚  â”‚   â””â”€ Ejecuta sync-production-safe.sql
â”‚  â”‚   â””â”€ Comando: node execute-sync-production.js
â”‚  â”‚
â”‚  â””â”€ check-production-diff.js           ğŸ” Verificar diferencias
â”‚      â””â”€ Muestra quÃ© falta en producciÃ³n
â”‚      â””â”€ Comando: node check-production-diff.js
â”‚
â”œâ”€ ğŸ“œ SCRIPTS SQL
â”‚  â”‚
â”‚  â”œâ”€ sync-production-safe.sql           â­ MIGRACIÃ“N COMPLETA
â”‚  â”‚   â””â”€ TODO el sistema sincronizado
â”‚  â”‚   â””â”€ 7 tablas nuevas + modificaciones
â”‚  â”‚   â””â”€ 100% seguro (idempotente)
â”‚  â”‚   â””â”€ Recomendado: SÃ
â”‚  â”‚
â”‚  â”œâ”€ migration-production-invoices.sql  Solo facturas
â”‚  â”‚   â””â”€ 3 tablas de facturas
â”‚  â”‚   â””â”€ Usar solo si ya tienes lo demÃ¡s
â”‚  â”‚
â”‚  â””â”€ migration-full-sync.sql            Generado por Prisma
â”‚      â””â”€ Uso avanzado
â”‚
â””â”€ ğŸ“š DOCUMENTACIÃ“N
   â”‚
   â”œâ”€ SYNC-PRODUCTION-GUIDE.md           ğŸ“– GuÃ­a completa
   â”‚   â””â”€ Detalles de sincronizaciÃ³n
   â”‚   â””â”€ Troubleshooting
   â”‚   â””â”€ Todas las opciones
   â”‚
   â””â”€ GUIA-MIGRACION-PRODUCCION.md       ğŸ“– GuÃ­a de facturas
       â””â”€ EspecÃ­fica para mÃ³dulo de facturas


ğŸš¦ FLUJOS DE TRABAJO
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FLUJO 1: TODO AUTOMÃTICO (Recomendado para la mayorÃ­a) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  1. cd backend-perfumeria
  2. node create-backup.js
     â†“
     Crea backup automÃ¡tico
     â†“
     Pregunta si ejecutar migraciÃ³n
     â†“
     (Si dices "sÃ­")
     â†“
  3. Ejecuta migraciÃ³n automÃ¡ticamente
  4. npx prisma generate
  5. Reiniciar backend
  âœ… Listo


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FLUJO 2: VERIFICAR PRIMERO (Para los precavidos)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  1. node check-production-diff.js
     â†“
     Muestra quÃ© falta en producciÃ³n
     â†“
  2. node create-backup.js
     â†“
  3. node execute-sync-production.js
     â†“
  4. npx prisma generate
  5. Reiniciar backend
  âœ… Listo


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FLUJO 3: MANUAL CON pgAdmin (Para los visuales)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  1. Abrir pgAdmin
  2. Hacer backup manual (opcional)
  3. Query Tool
  4. Open â†’ sync-production-safe.sql
  5. Execute (F5)
  6. Verificar mensajes de Ã©xito
  7. npx prisma generate
  8. Reiniciar backend
  âœ… Listo


ğŸ“Š Â¿QUÃ‰ SE SINCRONIZA?
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

TABLAS NUEVAS (7):
  âœ… InvoiceItem           - Ãtems de facturas con FIFO
  âœ… InvoicePayment        - Pagos/abonos a facturas
  âœ… company_config        - ConfiguraciÃ³n empresa
  âœ… module_permissions    - Permisos por mÃ³dulo
  âœ… product_batches       - Sistema FIFO inventario
  âœ… system_modules        - MÃ³dulos del sistema
  âœ… system_parameters     - ParÃ¡metros configurables

MODIFICACIONES A TABLAS EXISTENTES:
  ğŸ“ User       â†’ + companyCode
  ğŸ“ Supplier   â†’ nit ahora nullable
  ğŸ“ Purchase   â†’ + 6 campos (subtotal, discount, etc.)
  ğŸ“ Invoice    â†’ + 8 campos (supplierId, notes, etc.)

ENUMS ACTUALIZADOS:
  ğŸ”§ ExpenseCategory â†’ + SUPPLIER_PAYMENT


âœ… GARANTÃAS DE SEGURIDAD
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

  âœ“ NO elimina datos
  âœ“ NO borra tablas
  âœ“ Idempotente (seguro ejecutar varias veces)
  âœ“ Transaccional (BEGIN/COMMIT)
  âœ“ Verificaciones IF NOT EXISTS
  âœ“ Preserva datos existentes al 100%


ğŸ¯ CASOS DE USO
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SituaciÃ³n                  â”‚ Usar                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Primera vez en producciÃ³n  â”‚ sync-production-safe.sql    â”‚
â”‚ No sÃ© quÃ© falta            â”‚ check-production-diff.js    â”‚
â”‚ ProducciÃ³n desactualizada  â”‚ sync-production-safe.sql    â”‚
â”‚ Solo necesito facturas     â”‚ migration-production-...sql â”‚
â”‚ Quiero estar 100% seguro   â”‚ create-backup.js primero    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â±ï¸ TIEMPOS ESTIMADOS
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

  Backup automÃ¡tico:          ~10-30 segundos
  MigraciÃ³n SQL:              ~5-10 segundos
  Regenerar Prisma Client:    ~5 segundos
  Reinicio backend:           ~5 segundos
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  TOTAL:                      < 1 minuto


ğŸ†˜ AYUDA RÃPIDA
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

  Error                     SoluciÃ³n
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  "psql not found"      â†’  Usar pgAdmin (mÃ¡s fÃ¡cil)
  "permission denied"   â†’  Ejecutar como admin DB
  "already exists"      â†’  âœ… Normal, script lo salta
  "cannot connect"      â†’  Verificar DATABASE_URL
  Cambios no visibles   â†’  Regenerar Prisma + reiniciar


ğŸ“ DOCUMENTACIÃ“N COMPLETA
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

  ğŸ“– README-SYNC-PRODUCTION.md      - GuÃ­a maestra
  ğŸ“– SYNC-PRODUCTION-GUIDE.md       - GuÃ­a detallada
  ğŸ“– GUIA-MIGRACION-PRODUCCION.md   - Solo facturas


âœ¨ RECOMENDACIÃ“N FINAL
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

  Para la mayorÃ­a de casos:

    cd backend-perfumeria
    node create-backup.js

  Eso es todo. El script te guiarÃ¡ paso a paso.


â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
VersiÃ³n: 2.0 | Fecha: 2025-10-25 | Estado: âœ… Listo
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
